<?php
    error_reporting(0);
    include "json.php";
    $config = include "config.inc.php";

    if (isset($_GET['img_first']) and isset($_GET['img_num'])){
        $img_first = $_GET['img_first'];
        $img_num = $_GET['img_num'];
        $conn = mysqli_connect($config['db_host'],$config['db_user'],$config['db_pwd'],$config['database']);

        if (mysqli_connect_errno($conn)){
            die("Can not connect mysql!".mysqli_connect_error());
        }

        $check = is_numeric($img_num) and is_numeric($img_first);

        if (!$check){
            $img_num = intval($img_num);
            $img_first = intval($img_first);
        }

        $sql = "SELECT * FROM images LIMIT $img_first,$img_num";
        $result = mysqli_query($conn,$sql);

        $i = 0;
        while($row=mysqli_fetch_array($result,MYSQLI_ASSOC)){
            $rows[$i] = $row;
            $i++;
        }
        $json = new Services_JSON();
        echo $json->encode(array('result'=>$rows));
        //echo json_encode(array('result'=>$rows),JSON_UNESCAPED_SLASHES);
    }else {
        die("Missing parameter img_first or img_num");
    }